## MODIFIED Requirements

### Requirement: Telegram WebApp Authentication
Система SHALL обеспечивать аутентификацию водителей через Telegram WebApp и Telegram Login Widget.

#### Scenario: Успешный вход через Telegram Mini App
- **WHEN** водитель открывает приложение в Telegram Mini App
- **THEN** система получает initData от Telegram WebApp
- **AND** валидирует initData используя HMAC-SHA256 с секретным ключом бота
- **AND** извлекается telegram_id пользователя
- **AND** возвращается JWT токен с информацией о водителе

#### Scenario: Успешный вход через Telegram Login Widget
- **WHEN** водитель открывает приложение в обычном браузере
- **THEN** отображается Telegram Login Widget
- **AND** при клике на виджет система получает данные пользователя
- **AND** валидирует данные используя SHA256(bot_token) для Login Widget формата
- **AND** извлекается telegram_id пользователя
- **AND** возвращается JWT токен с информацией о водителе

#### Scenario: Автоматическая регистрация нового водителя
- **WHEN** водитель впервые входит через Telegram (Mini App или Login Widget)
- **THEN** система автоматически создает запись водителя с данными из Telegram
- **AND** возвращается JWT токен для дальнейшей работы

#### Scenario: Использование сохраненного токена
- **WHEN** водитель повторно открывает приложение
- **THEN** система проверяет наличие сохраненного JWT токена в localStorage
- **AND** если токен валидный, авторизация пропускается без запроса к серверу
- **AND** если токена нет или он невалидный, запрашивается новая авторизация

#### Scenario: Невалидные данные Telegram
- **WHEN** отправляется запрос с подделанным или истекшим init_data
- **THEN** возвращается ошибка 401 Unauthorized
