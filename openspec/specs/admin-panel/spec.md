# admin-panel Specification

## Purpose
TBD - created by archiving change add-admin-panel. Update Purpose after archive.
## Requirements
### Requirement: Admin Command Access
Система SHALL предоставлять команду `/admin` для доступа к админской панели через Telegram бота.

#### Scenario: Доступ к админской панели
- **WHEN** администратор отправляет команду `/admin` в боте
- **THEN** открывается главное меню админской панели
- **AND** пользователь с ролью ADMIN получает доступ к функциям управления

#### Scenario: Запрет доступа не-администраторам
- **WHEN** пользователь без роли ADMIN пытается отправить команду `/admin`
- **THEN** команда игнорируется без ответа

### Requirement: Pending Users Management
Система SHALL позволять администраторам просматривать и одобрять пользователей с ролью PENDING.

#### Scenario: Просмотр ожидающих пользователей
- **WHEN** администратор выбирает "Ожидающие одобрения" в админском меню
- **THEN** отображается список всех пользователей с ролью PENDING
- **AND** для каждого пользователя показывается имя, telegram_id и статус

#### Scenario: Одобрение пользователя и назначение роли
- **WHEN** администратор выбирает пользователя из списка PENDING
- **THEN** открывается карточка пользователя с кнопками "Водитель" и "Диспетчер"
- **AND** при выборе роли пользователь получает выбранную роль
- **AND** пользователю отправляется уведомление в Telegram
- **AND** флаг is_active устанавливается в True

#### Scenario: Нет пользователей, ожидающих одобрения
- **WHEN** список пользователей PENDING пуст
- **THEN** отображается сообщение "Нет пользователей, ожидающих одобрения"

### Requirement: User Role Assignment
Система SHALL позволять администраторам назначать пользователям роли DRIVER или DISPATCHER.

#### Scenario: Назначение роли Водитель
- **WHEN** администратор нажимает кнопку "Водитель" на карточке пользователя
- **THEN** роль пользователя устанавливается в DRIVER
- **AND** пользователь становится активным (is_active=True)
- **AND** пользователь получает уведомление о назначении роли

#### Scenario: Назначение роли Диспетчер
- **WHEN** администратор нажимает кнопку "Диспетчер" на карточке пользователя
- **THEN** роль пользователя устанавливается в DISPATCHER
- **AND** пользователь становится активным (is_active=True)
- **AND** пользователь получает уведомление о назначении роли

### Requirement: User Blocking
Система SHALL позволять администраторам блокировать и разблокировать пользователей.

#### Scenario: Блокировка пользователя
- **WHEN** администратор нажимает кнопку "Заблокировать" на карточке активного пользователя
- **THEN** флаг is_active устанавливается в False
- **AND** пользователь теряет доступ к боту и API

#### Scenario: Разблокировка пользователя
- **WHEN** администратор нажимает кнопку "Разблокировать" на карточке заблокированного пользователя
- **THEN** флаг is_active устанавливается в True
- **AND** пользователь восстанавливает доступ к боту и API

#### Scenario: Отображение статуса блокировки
- **WHEN** администратор открывает карточку пользователя
- **THEN** отображается статус "Заблокирован" или "Активен"
- **AND** текст статуса имеет цветовую индикацию (красный/зелёный)

### Requirement: All Users Management
Система SHALL позволять администраторам просматривать список всех пользователей.

#### Scenario: Просмотр всех пользователей
- **WHEN** администратор выбирает "Все пользователи" в админском меню
- **THEN** отображается список всех зарегистрированных пользователей
- **AND** для каждого пользователя показывается имя, роль и статус активности

#### Scenario: Просмотр заблокированных пользователей
- **WHEN** администратор выбирает "Заблокированные" в админском меню
- **THEN** отображается список только заблокированных пользователей

### Requirement: New User Notification
Система SHALL автоматически уведомлять администратора о регистрации новых пользователей.

#### Scenario: Уведомление о новом пользователе
- **WHEN** новый пользователь впервые входит через Telegram (авто-регистрация)
- **THEN** администратор получает сообщение в Telegram с данными пользователя
- **AND** сообщение содержит имя, telegram_id, username
- **AND** сообщение содержит кнопку "Посмотреть" для быстрого перехода к списку PENDING

#### Scenario: Пользователь с ролью не PENDING
- **WHEN** новый пользователь регистрируется с ролью отличной от PENDING (редкий случай)
- **THEN** уведомление администратору не отправляется

### Requirement: Admin Authentication
Система SHALL проверять права администратора для всех действий админской панели.

#### Scenario: Проверка по telegram_id
- **WHEN** пользователь пытается выполнить админское действие
- **THEN** система проверяет telegram_id на соответствие ADMIN_TELEGRAM_ID

#### Scenario: Проверка по username
- **WHEN** пользователь пытается выполнить админское действие
- **THEN** система проверяет username на соответствие ADMIN_USERNAME (если настроен)

#### Scenario: Комбинированная проверка
- **WHEN** пользователь пытается выполнить админское действие
- **THEN** доступ разрешается если совпадает telegram_id OR username

