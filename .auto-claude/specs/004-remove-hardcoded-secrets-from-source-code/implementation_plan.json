{
  "feature": "Remove hardcoded secrets from source code",
  "workflow_type": "simple",
  "workflow_rationale": "Single-file security fix in backend config. No multi-service dependencies, no complex refactoring needed. This is a critical security vulnerability that requires removing hardcoded production credentials from src/config.py and ensuring they are only loaded from environment variables.",
  "phases": [
    {
      "id": "phase-1-security-fix",
      "name": "Security Fix",
      "type": "implementation",
      "description": "Remove hardcoded secrets from config.py and create .env.example template",
      "depends_on": [],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create .env.example template file with placeholder values",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            ".env.example"
          ],
          "patterns_from": [
            ".env",
            ".gitignore"
          ],
          "verification": {
            "type": "command",
            "command": "test -f .env.example && grep -q 'JWT_SECRET_KEY=' .env.example && grep -q 'TELEGRAM_BOT_TOKEN=' .env.example && grep -q 'SECRET_KEY=' .env.example && grep -q 'DATABASE_URL=' .env.example",
            "expected": "Exit code 0"
          },
          "status": "completed",
          "notes": "Created .env.example template file with placeholder values for all sensitive configuration. Also fixed .gitignore to ensure .env.example is tracked in git (removed duplicate entry that was ignoring it).",
          "updated_at": "2026-01-29T17:27:15.258350+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Remove hardcoded secrets from src/config.py default values",
          "service": "backend",
          "files_to_modify": [
            "src/config.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -E '(8237141688|6064f7b6b3e7f6d1a9e8b7c6d5a4f3e2|tms_secret|your-secret-key-change-me)' src/config.py || echo 'No hardcoded secrets found'",
            "expected": "No hardcoded secrets found"
          },
          "status": "completed",
          "notes": "Successfully removed all hardcoded secrets from src/config.py. Replaced DATABASE_URL (tms_secret), SECRET_KEY (your-secret-key-change-me), JWT_SECRET_KEY (hex string), and TELEGRAM_BOT_TOKEN (production token) with 'CHANGE_ME_IN_ENV' placeholder values. Verification confirms no hardcoded secrets remain in the file.",
          "updated_at": "2026-01-29T17:29:15.753995+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Verify application can load configuration from .env file",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [
            "src/main.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.config import settings; assert settings.JWT_SECRET_KEY != 'CHANGE_ME'; assert settings.TELEGRAM_BOT_TOKEN != 'CHANGE_ME'; print('Configuration loads correctly from .env')\"",
            "expected": "Configuration loads correctly from .env"
          },
          "status": "completed",
          "notes": "Successfully verified that the application loads configuration from .env file. Tested that JWT_SECRET_KEY, TELEGRAM_BOT_TOKEN, and SECRET_KEY are all properly loaded from the .env file (not using placeholder values from src/config.py). The pydantic-settings BaseSettings with env_file='.env' configuration works correctly.",
          "updated_at": "2026-01-29T17:30:59.276575+00:00"
        },
        {
          "id": "subtask-1-4",
          "description": "Update .gitignore to ensure .env.example is NOT ignored",
          "service": "backend",
          "files_to_modify": [
            ".gitignore"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -v '^.env.example' .gitignore | grep -q '.env' && echo 'Gitignore correct: .env ignored, .env.example allowed'",
            "expected": "Gitignore correct: .env ignored, .env.example allowed"
          },
          "status": "pending",
          "notes": "The .gitignore currently has conflicting entries: line 9 says '!.env.example' (don't ignore) but line 77 says '.env.example' (ignore). Remove line 77 to ensure .env.example is committed to version control."
        }
      ]
    },
    {
      "id": "phase-2-verification",
      "name": "Security Verification",
      "type": "implementation",
      "description": "Verify no secrets remain in source code and configuration works",
      "depends_on": [
        "phase-1-security-fix"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Run secrets scanner to verify no hardcoded secrets remain",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "python .auto-claude/scan_secrets.py --file src/config.py --json 2>/dev/null | python -c \"import sys, json; data = json.load(sys.stdin); sys.exit(0 if len(data.get('findings', [])) == 0 else 1)\" && echo 'No secrets detected'",
            "expected": "No secrets detected"
          },
          "status": "pending",
          "notes": "Use the auto-claude secrets scanner to verify that src/config.py no longer contains hardcoded secrets. The scanner should find zero findings in config.py."
        },
        {
          "id": "subtask-2-2",
          "description": "Document the security fix in a SECURITY_FIX.md file",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "SECURITY_FIX.md"
          ],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Review SECURITY_FIX.md for completeness: (1) What was fixed, (2) Why it was a security issue, (3) How to set up environment variables"
          },
          "status": "pending",
          "notes": "Create documentation explaining: (1) The security vulnerability that was fixed, (2) Which secrets were removed, (3) How developers should configure their .env file using .env.example as a template, (4) Reminder to never commit .env file."
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 2,
    "total_subtasks": 6,
    "services_involved": [
      "backend"
    ],
    "critical_files": [
      "src/config.py",
      ".env.example",
      ".gitignore"
    ],
    "parallelism": {
      "max_parallel_phases": 1,
      "parallel_groups": [],
      "recommended_workers": 1,
      "speedup_estimate": "N/A - sequential execution required",
      "reasoning": "Phase 2 verification depends on Phase 1 completion. All subtasks within each phase must be completed in order."
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 004 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "critical",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "security_scan",
      "manual_review"
    ],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "No hardcoded secrets remain in src/config.py",
      "Secrets scanner reports zero findings in config.py",
      ".env.example exists with placeholder values",
      "Application successfully loads configuration from .env",
      ".gitignore allows .env.example to be committed",
      "Documentation created explaining the security fix"
    ],
    "verification_steps": [
      {
        "name": "Secrets Scan",
        "command": "python .auto-claude/scan_secrets.py --file src/config.py --json",
        "expected_outcome": "Zero secrets detected in src/config.py",
        "type": "security",
        "required": true,
        "blocking": true
      },
      {
        "name": "Configuration Load Test",
        "command": "python -c \"from src.config import settings; print(f'JWT: {settings.JWT_SECRET_KEY[:10]}..., Bot: {settings.TELEGRAM_BOT_TOKEN[:10]}...')\"",
        "expected_outcome": "Settings load successfully from .env file",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Manual Code Review",
        "command": "cat src/config.py | grep -E '(DATABASE_URL|SECRET_KEY|JWT_SECRET_KEY|TELEGRAM_BOT_TOKEN)'",
        "expected_outcome": "No hardcoded production credentials visible",
        "type": "manual",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "Critical security vulnerability requires strict verification. Must ensure no secrets remain in source code while maintaining application functionality."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": false,
      "commands": [],
      "minimum_coverage": null,
      "reasoning": "Configuration changes don't require new unit tests - verification is via security scanning"
    },
    "integration_tests": {
      "required": false,
      "commands": [],
      "services_to_test": [],
      "reasoning": "No integration testing needed - this is a configuration security fix"
    },
    "e2e_tests": {
      "required": false,
      "commands": [],
      "flows": [],
      "reasoning": "No E2E testing needed - application behavior unchanged"
    },
    "browser_verification": {
      "required": false,
      "pages": [],
      "reasoning": "Backend-only change, no frontend impact"
    },
    "database_verification": {
      "required": false,
      "checks": [],
      "reasoning": "No database schema changes"
    },
    "security_verification": {
      "required": true,
      "checks": [
        "Run secrets scanner on src/config.py",
        "Verify no hardcoded credentials remain",
        "Verify .env.example contains only placeholders",
        "Verify .env is gitignored but .env.example is not"
      ]
    }
  },
  "qa_signoff": null,
  "status": "in_progress",
  "planStatus": "in_progress",
  "updated_at": "2026-01-29T17:31:16.876Z",
  "last_updated": "2026-01-29T17:30:59.276586+00:00"
}