{
  "security_hardening": [
    {
      "id": "sec-001",
      "type": "security_hardening",
      "title": "Remove hardcoded secrets from source code",
      "description": "The src/config.py file contains hardcoded default values for critical secrets including JWT_SECRET_KEY, TELEGRAM_BOT_TOKEN, SECRET_KEY, and database credentials. These secrets are visible in source code and will be committed to version control, exposing production credentials.",
      "rationale": "Hardcoded secrets are a critical security vulnerability (OWASP A07). Anyone with access to the repository can extract these credentials and gain unauthorized access to the Telegram bot, impersonate users via JWT tokens, or access the database directly.",
      "category": "secrets_management",
      "severity": "critical",
      "affectedFiles": ["src/config.py", ".env"],
      "vulnerability": "CWE-798: Use of Hard-coded Credentials",
      "currentRisk": "Active production secrets (Telegram bot token, JWT key) are exposed in source code. Attackers can: 1) Control the Telegram bot, 2) Forge valid JWT tokens, 3) Access the database",
      "remediation": "1) Remove all default secret values from config.py - replace with placeholder strings like 'CHANGE_ME' that cause explicit failures. 2) Ensure .env is in .gitignore (verified). 3) Add a startup check that validates no default/placeholder secrets are being used. 4) Rotate all exposed credentials immediately. 5) Use environment variables without fallback defaults for sensitive values.",
      "references": ["https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/", "https://cwe.mitre.org/data/definitions/798.html"],
      "compliance": ["SOC2", "PCI-DSS", "GDPR"]
    },
    {
      "id": "sec-002",
      "type": "security_hardening",
      "title": "Fix sensitive data logging in auth service",
      "description": "The auth_service.py logs partial bot tokens and hash information during authentication: 'Using bot_token: {self.bot_token[:10]}...{self.bot_token[-5:]}' and 'Received hash: {received_hash[:20]}...'. This exposes sensitive cryptographic material in application logs.",
      "rationale": "Logging sensitive authentication data violates data protection best practices (OWASP A09). Log files often have weaker access controls than application code and may be retained for extended periods, aggregated in log management systems, or accidentally exposed.",
      "category": "data_protection",
      "severity": "high",
      "affectedFiles": ["src/services/auth_service.py"],
      "vulnerability": "CWE-532: Insertion of Sensitive Information into Log File",
      "currentRisk": "Partial secrets in logs could aid brute-force attacks. Hash prefixes provide information about valid authentication attempts. Logs may be accessible to operators, third-party logging services, or attackers who compromise log storage.",
      "remediation": "1) Remove all logging of bot_token fragments. 2) Remove logging of hash values - only log success/failure status. 3) Replace sensitive data with '[REDACTED]' or remove entirely. 4) Use structured logging with explicit field exclusions. 5) Audit all logging statements for PII and secrets.",
      "references": ["https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/", "https://cwe.mitre.org/data/definitions/532.html"],
      "compliance": ["SOC2", "GDPR"]
    },
    {
      "id": "sec-003",
      "type": "security_hardening",
      "title": "Reduce Telegram initData expiration window",
      "description": "TELEGRAM_INIT_DATA_EXPIRE_SECONDS is set to 86400 (24 hours), which is excessively long. Telegram's official recommendation is to validate initData within a few minutes of generation, as it's intended for immediate authentication, not persistent sessions.",
      "rationale": "A 24-hour validity window significantly increases the attack window for replay attacks. If an attacker captures initData (via MITM, XSS, or log exposure), they have a full day to use it for unauthorized authentication.",
      "category": "authentication",
      "severity": "high",
      "affectedFiles": ["src/config.py", "src/services/auth_service.py"],
      "vulnerability": "CWE-613: Insufficient Session Expiration",
      "currentRisk": "Captured initData strings can be replayed for 24 hours to impersonate users and generate valid JWT tokens. Combined with the logging vulnerability, this creates a significant authentication bypass risk.",
      "remediation": "1) Reduce TELEGRAM_INIT_DATA_EXPIRE_SECONDS to 300-600 (5-10 minutes). 2) Implement nonce/one-time-use tracking for initData via Redis to prevent replay attacks. 3) Consider adding additional client fingerprinting. 4) Document that the JWT token (24hr validity) is for session persistence, not the initData.",
      "references": ["https://core.telegram.org/bots/webapps#validating-data-received-via-the-web-app", "https://cwe.mitre.org/data/definitions/613.html"],
      "compliance": ["SOC2"]
    },
    {
      "id": "sec-004",
      "type": "security_hardening",
      "title": "Disable API documentation in production",
      "description": "The nginx configuration exposes /docs, /redoc, and /openapi.json endpoints in production without access controls. These endpoints reveal the entire API structure, including all endpoints, parameters, and data models to potential attackers.",
      "rationale": "API documentation endpoints provide attackers with a complete map of the application's attack surface. This information aids in discovering hidden endpoints, understanding data structures, and crafting targeted attacks.",
      "category": "configuration",
      "severity": "medium",
      "affectedFiles": ["nginx/nginx.conf", "src/fastapi_core.py"],
      "vulnerability": "CWE-200: Exposure of Sensitive Information",
      "currentRisk": "Attackers can enumerate all API endpoints, understand authentication requirements, and discover potentially vulnerable endpoints without any trial-and-error.",
      "remediation": "1) Add conditional logic in FastAPI to disable docs in production: `docs_url=None if APP_ENV=='production' else '/docs'`. 2) Alternatively, add HTTP Basic Auth to nginx for /docs, /redoc, /openapi.json locations. 3) Block these paths entirely in production nginx config. 4) If docs must be accessible, restrict by IP to internal networks only.",
      "references": ["https://owasp.org/Top10/A05_2021-Security_Misconfiguration/", "https://cwe.mitre.org/data/definitions/200.html"],
      "compliance": ["SOC2"]
    },
    {
      "id": "sec-005",
      "type": "security_hardening",
      "title": "Add Content-Security-Policy header",
      "description": "The nginx configuration includes X-Frame-Options, X-Content-Type-Options, and X-XSS-Protection, but lacks a Content-Security-Policy (CSP) header. CSP is the primary defense against XSS attacks and provides defense-in-depth for the React frontend.",
      "rationale": "CSP is the most effective browser-side protection against XSS attacks. The current headers are legacy protections that modern browsers are deprecating in favor of CSP. Without CSP, any XSS vulnerability can execute arbitrary JavaScript.",
      "category": "configuration",
      "severity": "medium",
      "affectedFiles": ["nginx/nginx.conf"],
      "vulnerability": "CWE-1021: Improper Restriction of Rendered UI Layers or Frames",
      "currentRisk": "If an XSS vulnerability exists in the React app or is introduced in future code, there's no browser-level protection against script execution. This could lead to session hijacking, credential theft, or complete account takeover.",
      "remediation": "1) Add a CSP header: `add_header Content-Security-Policy \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://*.tile.openstreetmap.org; connect-src 'self' wss://myappnf.ru; frame-ancestors 'self';\" always;` 2) Test thoroughly with CSP reporting first (`Content-Security-Policy-Report-Only`). 3) Adjust for Telegram WebApp SDK requirements. 4) Consider adding nonce-based script loading for stricter CSP.",
      "references": ["https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP", "https://owasp.org/www-project-secure-headers/"],
      "compliance": ["SOC2", "PCI-DSS"]
    }
  ],
  "metadata": {
    "dependenciesScanned": 49,
    "knownVulnerabilities": 0,
    "filesAnalyzed": 62,
    "criticalIssues": 1,
    "highIssues": 2,
    "mediumIssues": 2,
    "lowIssues": 0,
    "generatedAt": "2026-01-21T20:00:00Z",
    "analysisNotes": "Focused on authentication, secrets management, and configuration security. SQLAlchemy ORM usage appears to prevent SQL injection. No command injection patterns detected. CORS is properly configured with specific domains."
  }
}
