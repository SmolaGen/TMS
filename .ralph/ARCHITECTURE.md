# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Ralph

Ralph –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **Autonomous Agentic Loop** (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∞–≥–µ–Ω—Ç–Ω—ã–π —Ü–∏–∫–ª) —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç–æ–π.

## 1. –ê–≥–µ–Ω—Ç–Ω—ã–π —Ü–∏–∫–ª (The Loop)

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤, Ralph —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ:

```mermaid
graph TD
    Start((Start)) --> Task[–í—ã–±–æ—Ä –∑–∞–¥–∞—á–∏ –∏–∑ PRD.md]
    Task --> Context[–°–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞]
    Context --> AI[–ó–∞–ø—Ä–æ—Å –∫ LLM]
    AI --> Parse[–ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞: log, write, exec]
    Parse --> Validate[–í–∞–ª–∏–¥–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏]
    Validate -- Safe --> Execute[–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
    Execute --> Sandbox[–ó–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥ –≤ Docker]
    Sandbox --> Check[–ü—Ä–æ–≤–µ—Ä–∫–∞ done?]
    Check -- No --> AI
    Check -- Yes --> Complete[Mark PRD [x]]
    Complete --> End((Finish))
```

### –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
–ê–≥–µ–Ω—Ç –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `MAX_ITERATIONS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3) –Ω–∞ –æ–¥–Ω—É —Å–µ—Å—Å–∏—é. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ —Ç—Ä–∞—Ç—É —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

## 2. –ú–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã

### [ralph.py] ‚Äî –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
–£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–∏—Å—Ç–µ–º—ã:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Docker-–ø–µ—Å–æ—á–Ω–∏—Ü—ã.
- –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–∏–∫–ª –ø–æ –∑–∞–¥–∞—á–∞–º.
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ (Graceful Shutdown).
- –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### [utils.py] ‚Äî –°–ª–æ–π –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
–†–µ–∞–ª–∏–∑—É–µ—Ç **Guardrails**:
- `safe_write()`: –ü–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –¥–µ–ª–∞–µ—Ç `backup_file()`.
- `validate_write()`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç "–∑–¥–æ—Ä–æ–≤—å–µ" –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–Ω–µ –ø—É—Å—Ç–æ–π –ª–∏ –æ–Ω, –Ω–µ —É–¥–∞–ª–µ–Ω—ã –ª–∏ –∏–º–ø–æ—Ä—Ç—ã).
- `validate_command()`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–æ whitelist –∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.

### [llm_client.py] ‚Äî –°–ª–æ–π –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VibeProxy –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É **Resilient Agent**:
- **RetryPolicy**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ 429 (Rate Limit) –∏–ª–∏ 5xx –æ—à–∏–±–∫–∞—Ö.
- **Exponential Backoff**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏.
- **Jitter**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –≤ –ø–∞—É–∑—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π.

## 3. –ü–µ—Å–æ—á–Ω–∏—Ü–∞ (Docker Sandbox)

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã (`pytest`, `npm test`), –∫–æ—Ç–æ—Ä—ã–µ –∞–≥–µ–Ω—Ç —Ö–æ—á–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤–æ–µ–≥–æ –∫–æ–¥–∞, –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- **–ò–∑–æ–ª—è—Ü–∏—è**: –ê–≥–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –≤–∞—à–µ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.
- **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –°—Ä–µ–¥–∞ –≤ Docker –≤—Å–µ–≥–¥–∞ —á–∏—Å—Ç–∞—è –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç production –æ–∫—Ä—É–∂–µ–Ω–∏—é.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –î–∞–∂–µ –µ—Å–ª–∏ AI —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥, –µ–≥–æ –≤–ª–∏—è–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **–Ø–∑—ã–∫**: Python 3.11+
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: JSON (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker
- **AI API**: VibeProxy
