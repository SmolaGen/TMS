# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ TMS

---

## –û–±—â–∞—è –°—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –ö–õ–ò–ï–ù–¢–´                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Web App        ‚îÇ   Telegram Bot   ‚îÇ   Mobile (PWA)           ‚îÇ
‚îÇ   (Next.js)      ‚îÇ   (Aiogram)      ‚îÇ   (Next.js + TWA)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                  ‚îÇ                    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    Nginx      ‚îÇ
                    ‚îÇ   (Reverse    ‚îÇ
                    ‚îÇ    Proxy)     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                  ‚îÇ                  ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Frontend ‚îÇ     ‚îÇ   Backend   ‚îÇ    ‚îÇ  Telegram   ‚îÇ
   ‚îÇ  :3000    ‚îÇ     ‚îÇ   :8000     ‚îÇ    ‚îÇ   Bot       ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                  ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                                   ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                     ‚îÇ          ‚îÇ                ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ PostgreSQL‚îÇ        ‚îÇ   Redis     ‚îÇ   ‚îÇ  OSRM  ‚îÇ  ‚îÇ Celery ‚îÇ
   ‚îÇ + PostGIS ‚îÇ        ‚îÇ   (Cache)   ‚îÇ   ‚îÇ (Maps) ‚îÇ  ‚îÇ(Tasks) ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°–ª–æ–∏ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. API Layer (Presentation)
**–ü—É—Ç—å:** `src/api/`

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Pydantic)
- –í—ã–∑—ã–≤–∞–µ—Ç Service Layer
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã

```python
# src/api/v1/orders.py
@router.post("/orders")
async def create_order(data: OrderCreate) -> OrderResponse:
    return await order_service.create(data)
```

### 2. Service Layer (Business Logic)
**–ü—É—Ç—å:** `src/services/`

- –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ù–µ –∑–Ω–∞–µ—Ç –æ HTTP/FastAPI

```python
# src/services/order.py
class OrderService:
    async def create(self, data: OrderCreate) -> Order:
        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        order = Order(**data.dict())
        await self.db.add(order)
        return order
```

### 3. Data Layer (Persistence)
**–ü—É—Ç—å:** `src/db/`

- –ú–æ–¥–µ–ª–∏ SQLAlchemy
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic

```python
# src/db/models/order.py
class Order(Base):
    __tablename__ = "orders"
    id = Column(Integer, primary_key=True)
    status = Column(Enum(OrderStatus))
```

---

## –ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏

### Orders (–ó–∞–∫–∞–∑—ã)
```
src/api/v1/orders.py      # API endpoints
src/services/order.py     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
src/db/models/order.py    # ORM –º–æ–¥–µ–ª—å
src/schemas/order.py      # Pydantic —Å—Ö–µ–º—ã
```

### Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
```
src/api/v1/users.py
src/services/user.py
src/db/models/user.py
src/schemas/user.py
```

### Shifts (–°–º–µ–Ω—ã)
```
src/api/v1/shifts.py
src/services/shift.py
src/db/models/shift.py
src/schemas/shift.py
```

### Geolocation (–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è)
```
src/api/v1/geo.py
src/services/geo.py       # –†–∞–±–æ—Ç–∞ —Å PostGIS
src/services/osrm.py      # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
```

---

## Frontend –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### App Router (Next.js 14)
```
frontend/src/app/
‚îú‚îÄ‚îÄ (auth)/               # –ì—Ä—É–ø–ø–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îú‚îÄ‚îÄ (dashboard)/          # –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ orders/
‚îÇ   ‚îú‚îÄ‚îÄ shifts/
‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îú‚îÄ‚îÄ api/                  # API routes (BFF)
‚îî‚îÄ‚îÄ layout.tsx            # –ö–æ—Ä–Ω–µ–≤–æ–π layout
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```
frontend/src/components/
‚îú‚îÄ‚îÄ ui/                   # –ë–∞–∑–æ–≤—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Button/
‚îÇ   ‚îú‚îÄ‚îÄ Input/
‚îÇ   ‚îî‚îÄ‚îÄ Modal/
‚îú‚îÄ‚îÄ features/             # –§–∏—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ OrderCard/
‚îÇ   ‚îî‚îÄ‚îÄ ShiftForm/
‚îî‚îÄ‚îÄ layouts/              # Layouts
    ‚îú‚îÄ‚îÄ Header/
    ‚îî‚îÄ‚îÄ Sidebar/
```

---

## –ü–æ—Ç–æ–∫–∏ –î–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ –ó–∞–∫–∞–∑–∞
```
1. User ‚Üí Frontend (—Ñ–æ—Ä–º–∞)
2. Frontend ‚Üí POST /api/v1/orders
3. API Layer ‚Üí Validate OrderCreate
4. Service Layer ‚Üí Create Order
5. Data Layer ‚Üí INSERT INTO orders
6. WebSocket ‚Üí Notify drivers
7. Response ‚Üí Frontend
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ì–µ–æ–ª–æ–∫–∞—Ü–∏–∏
```
1. Telegram Bot ‚Üí –ü–æ–ª—É—á–∞–µ—Ç location
2. Bot ‚Üí POST /api/v1/geo/update
3. Service ‚Üí UPDATE drivers SET location
4. Redis ‚Üí Cache current position
5. WebSocket ‚Üí Broadcast to dashboard
```

---

## –í–∞–∂–Ω—ã–µ –ü–∞—Ç—Ç–µ—Ä–Ω—ã

### Dependency Injection
```python
async def get_order_service(
    db: AsyncSession = Depends(get_db),
) -> OrderService:
    return OrderService(db)
```

### Repository Pattern (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```python
class OrderRepository:
    async def get_by_id(self, id: int) -> Order | None:
        return await self.db.get(Order, id)
```

### Event-Driven (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
```python
# –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
await event_bus.publish(OrderCreated(order_id=order.id))
```
