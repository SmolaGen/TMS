# driver-management Specification

## Purpose
TBD - created by archiving change add-missing-specs. Update Purpose after archive.
## Requirements
### Requirement: Driver Registration
Система SHALL предоставлять возможность регистрации новых водителей через API.

#### Scenario: Успешная регистрация водителя
- **WHEN** отправляется POST запрос на `/api/v1/drivers` с валидными данными (telegram_id, name, phone)
- **THEN** создается новый водитель в БД со статусом OFFLINE
- **AND** возвращается DriverResponse с данными созданного водителя

#### Scenario: Автоматическая регистрация через Telegram
- **WHEN** водитель впервые входит через Telegram WebApp
- **THEN** система автоматически создает запись водителя с данными из Telegram
- **AND** возвращается JWT токен для дальнейшей работы

### Requirement: Driver List Retrieval
Система SHALL предоставлять список всех водителей для авторизованных пользователей.

#### Scenario: Получение списка водителей
- **WHEN** отправляется GET запрос на `/api/v1/drivers` с валидным JWT токеном
- **THEN** возвращается список всех водителей с их статусами и базовой информацией

#### Scenario: Получение конкретного водителя
- **WHEN** отправляется GET запрос на `/api/v1/drivers/{driver_id}` с валидным токеном
- **THEN** возвращается детальная информация о водителе, включая связанные заказы

### Requirement: Driver Status Management
Система SHALL управлять статусами водителей (AVAILABLE, BUSY, OFFLINE).

#### Scenario: Обновление статуса водителя
- **WHEN** водитель обновляет свой профиль через PATCH `/api/v1/drivers/{driver_id}`
- **THEN** статус водителя обновляется в БД
- **AND** изменения отражаются в реальном времени через WebSocket

#### Scenario: Автоматическое изменение статуса при назначении заказа
- **WHEN** водителю назначается заказ
- **THEN** статус водителя автоматически меняется на BUSY

#### Scenario: Автоматическое изменение статуса при завершении заказа
- **WHEN** водитель завершает заказ
- **THEN** статус водителя автоматически меняется на AVAILABLE

### Requirement: Driver Profile Update
Система SHALL позволять водителям обновлять свой профиль.

#### Scenario: Обновление профиля водителем
- **WHEN** водитель отправляет PATCH запрос на `/api/v1/drivers/{driver_id}` с обновленными данными
- **THEN** профиль водителя обновляется в БД
- **AND** возвращается обновленный DriverResponse

#### Scenario: Запрет обновления чужого профиля
- **WHEN** водитель пытается обновить профиль другого водителя
- **THEN** возвращается ошибка 403 Forbidden

